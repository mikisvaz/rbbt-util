# vim: filetype=ruby :
require 'rbbt'
require 'cgi'
require 'rbbt/util/simpleopt'

options = SOPT.get("-lr--limit_rate*:-c--continue")

rate = options.delete :limit_rate
continue = options.delete :continue

continue = true if continue.nil?

resource, file, destination = ARGV.shift, ARGV.shift, ARGV.shift

resource_server = Rbbt.etc.resource_server.read.chomp

url = File.join(resource_server, resource, 'get_file?' + Misc.hash2GET_params(:file => file, :produce => false, :_format => 'raw'))

FileUtils.mkdir_p File.dirname(destination)

`wget #{ rate ?  "--limit-rate=#{ rate }" : ""}  #{continue ? "-c" : ""} -O '#{ destination }' '#{ url }'`
#Open.write(destination, Open.read(url, :nocache => true))
